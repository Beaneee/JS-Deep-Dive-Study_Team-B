## 23.1  소스코드의 타입

> 자바스크립트 엔진은 소스코드를 4가지 타입으로 구분한다. 소스코드의 타입에 ㄸ라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르다.
> 
- 4가지 타입의 소스 코드
    
    
    | 소스 코드의 타입 | 설명 |
    | --- | --- |
    | 전역 코드(global code) | 전역에 존재하는 소스코드로, 전역에 정의된 함수, 클래스 등의 내부 코드는 포함되지 않는다.  |
    | 함수 코드(function code) | 함수 내부에 존재하는 소스코드로, 함수 내부에 중첩된 함수, 클래스 등의 내부 코드는 포함되지 않는다.  |
    | eval 코드(eval code) | 빌트인 전역함수인 eval 함수에 인수로 전달되어 실행되는 소스코드로, strict mode에서 자신만의 독자적인 스코프를 생성한다. |
    | 모듈 코드(module code) | 모듈 내부에 존재하는 소스코드로, 모듈 내부의 함수, 클래스 드으이 내부 코드는 포함되지 않는다.  |

<br>

## 23.2 소스코드의 평가와 실행

> 자바스크립트 엔진은 소스코드를 평가하고 실행하는 두 가지 과정을 통해 코드를 처리한다.
> 
- **소스코드 평가**: 실행 컨텍스트를 생성하고 변수 및 함수 선언문을 실행하여 식별자를 스코프에 등록한다.
- **소스코드 실행**: 선언문을 제외한 소스코드를 순차적으로 실행하며, 변수의 참조를 실행 컨텍스트에서 검색하고 관리한다.

```jsx
var x;
x = 1
```

위 코드에서는 소스코드 평가 과정에서 `var x`가 선언되어 스코프에 등록되고, 실행 과정에서 `x = 1`이 실행된다.
<br>

## 23.3 실행 컨텍스트의 역할

> 실행 컨텍스트는 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역이다.
> 
- 아래의 모든것을 관리하는것이 실행 컨텍스트
    - `식별자(변수, 함수, 클래스 등의 이름)를 등록하고 관리하는 스코프`와 `코드 실행 순서 관리`를 구현한 내부 메커니즘. 모든 코드는 실행컨텍스트를 통해 실행되고 관리된다.
    - 식별자와 스코프는 실행 컨텍스트의 `렉시컬 환경`으로 관리하고 코드 실행 순서는 `실행 컨텍스트 스택`으로 관리한다.

```jsx
const x = 1;
function foo(a) {
    const y = 2;
    console.log(a + x + y); // 103
}
foo(100);
```

- **전역 코드 평가**: 전역 실행 컨텍스트가 생성되고, 전역 변수 `x`와 함수 `foo`가 스코프에 등록된다.
- **전역 코드 실행**: `x`에 값이 할당되고, 함수 `foo`가 호출된다.
- **함수 코드 평가**: 함수 `foo`의 실행 컨텍스트가 생성되고, 매개변수 `a`와 지역 변수 `y`가 스코프에 등록된다.
- **함수 코드 실행**: 변수와 함수가 참조되고, `console.log`가 호출되어 결과를 출력한다.
<br>

## 23.4 실행 컨텍스트 스택

> 실행 컨텍스트 스택은 코드의 실행 순서를 관리하는 자료구조로, 실행 컨텍스트를 스택 구조로 쌓아올린다.
> 

```jsx
const x = 1;
function foo() {
    const y = 2;
    function bar() {
        const z = 3;
        console.log(x + y + z); // 6
    }
    bar();
}
foo();
```

- **전역 코드의 평가와 실행**: 전역 실행 컨텍스트가 생성되어 스택에 쌓이고, `x`와 `foo`가 등록된다.
- **`foo` 함수의 평가와 실행**: `foo` 실행 컨텍스트가 스택에 추가되고, `y`와 `bar`가 등록된다.
- **`bar` 함수의 평가와 실행**: `bar` 실행 컨텍스트가 스택에 추가되고, `z`가 등록된다.
- **실행 종료**: `bar` 실행이 끝나면 컨텍스트가 팝되고, `foo` 실행 종료 후 전역 코드 실행이 끝나면서 모든 컨텍스트가 스택에서 제거된다.
<br>

## 23.5 렉시컬 환경

> 렉시컬 환경은 식별자와 식별자에 바인딩된 값을 관리하고 상위 스코프에 대한 참조를 기록하는 자료구조로, 실행 컨텍스트를 구성하는 주요 컴포넌트다.
> 
- **환경 레코드**: 스코프에 포함된 식별자와 그 바인딩 값을 저장하는 저장소다.
- **외부 렉시컬 환경 참조**: 상위 스코프에 대한 참조로, 단방향 링크드 리스트 형태로 스코프 체인을 구현한다.

```jsx
let x = 10;
function foo() {
    let y = 20;
    function bar() {
        let z = 30;
        console.log(x + y + z); // 60
    }
    bar();
}
foo();
```
<br>

## 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

> 실행 컨텍스트는 코드의 실행 시점에 생성되며, 각 코드의 평가와 실행 과정에서 식별자를 검색하고 바인딩된 값을 관리한다.
> 
- **전역 객체 생성**: 전역 코드를 실행하기 전에 전역 객체가 생성되고, 빌트인 전역 프로퍼티와 함수가 등록된다.
- **전역 코드 평가**: 전역 실행 컨텍스트가 생성되고, 전역 변수가 스코프에 등록된다.
- **전역 코드 실행**: 전역 변수가 초기화되고 함수가 호출된다.
- **함수 코드 평가와 실행**: 각 함수가 호출될 때마다 실행 컨텍스트가 생성되고, 스코프에 식별자가 등록된 후 함수 코드가 실행된다.
- **코드 실행 종료**: 모든 코드가 실행된 후, 실행 컨텍스트 스택에서 컨텍스트가 제거된다.

```jsx
var x = 1;
const y = 2;

function foo(a) {
    var x = 3;
    const y = 4;
    function bar(b) {
        const z = 5;
        console.log(a + b + x + y + z); // 42
    }
    bar(10);
}

foo(20);
```
<br>

## 23.7 실행 컨텍스트와 블록 레벨 스코프

> let과 const 키워드는 블록 레벨 스코프를 따르며, 코드 블록 내에서만 유효한 변수를 선언할 수 있다.
> 

```jsx
let x = 1;
if (true) {
    let x = 10;
    console.log(x); // 10
}
console.log(x); // 1
```

- `if`문 블록 내에서 `let` 키워드로 선언된 변수는 블록 레벨 스코프를 가지며, 외부의 `x` 변수와 별도로 존재한다.
